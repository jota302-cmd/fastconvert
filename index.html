<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media-FastConvert | OptiMicroTools</title>
    <!-- AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8167884438770174"
        crossorigin="anonymous"></script>
    <meta name="description"
        content="Convert and optimize images locally with maximum privacy. PNG, JPG, WebP conversion in your browser.">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --cyan-electric: #06B6D4;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
        }

        .ad-slot {
            border: 1px dashed rgba(255, 255, 255, 0.1);
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: rgba(6, 182, 212, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            overflow: hidden;
            margin: 20px 0;
            border-radius: 12px;
        }

        .ad-slot::after {
            content: attr(data-label);
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .drag-active {
            border-color: var(--cyan-electric) !important;
            background: rgba(6, 182, 212, 0.05) !important;
        }

        /* Input Range Styling */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-runnable-track {
            background: rgba(255, 255, 255, 0.1);
            height: 4px;
            border-radius: 2px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--cyan-electric);
            margin-top: -6px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.3);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--cyan-electric); }
    </style>
</head>

<body class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="p-6 flex justify-between items-center max-w-7xl mx-auto w-full relative z-50">
        <a href="https://optimicrotools.com" title="Go to Home / Ir al Inicio" class="flex items-center gap-3 group">
            <div class="w-10 h-10 rounded-full bg-cyan-electric flex items-center justify-center transition-all group-hover:scale-110">
                <span class="text-black font-black text-xl">O</span>
            </div>
            <span class="font-bold text-xl tracking-tighter hidden sm:block">OptiMicro<span class="text-cyan-electric">Tools</span></span>
        </a>
        <button id="langToggle"
            class="glass px-4 py-2 rounded-full text-[10px] font-bold hover:border-cyan-electric transition-all tracking-widest uppercase">
            ES / EN
        </button>
    </header>

    <main class="flex-grow flex flex-col items-center px-4 max-w-4xl mx-auto w-full relative z-10">
        <!-- Top Ad Slot -->
        <div class="ad-slot w-full max-w-2xl" id="ad-top" data-label="Advertisement / Anuncio"></div>

        <section class="w-full text-center mt-8 animate-fade-in">
            <h1 id="mainTitle" class="text-5xl md:text-7xl font-black mb-6 tracking-tight">
                Media Optimization
            </h1>
            <p id="mainSubtitle" class="text-gray-400 text-lg md:text-xl mb-12 max-w-2xl mx-auto leading-relaxed">
                Conversión local ultra-rápida. Sin servidores, máxima privacidad y rendimiento de lujo.
            </p>

            <!-- Drag & Drop Area -->
            <div id="dropZone"
                class="glass rounded-[32px] p-12 mb-8 cursor-pointer transition-all duration-300 border-2 border-dashed border-white/5 hover:border-cyan-electric group relative overflow-hidden">
                <div class="absolute inset-0 bg-cyan-electric opacity-0 group-hover:opacity-5 transition-opacity"></div>
                <div class="relative z-10">
                    <div class="w-20 h-20 bg-white/5 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-cyan-electric" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                        </svg>
                    </div>
                    <h2 id="dropText" class="text-2xl font-bold mb-2">Suelta tu imagen aquí</h2>
                    <p id="dropHint" class="text-gray-500 text-sm tracking-wide">PNG, JPG, WebP hasta 20MB</p>
                </div>
                <input type="file" id="fileInput" class="hidden" accept="image/*">
            </div>

            <!-- Controls (Hidden until file selected) -->
            <div id="controls" class="hidden glass rounded-3xl p-8 w-full mb-8 text-left animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10 items-center">
                    <div>
                        <label id="formatLabel" class="block text-[10px] font-bold uppercase tracking-widest text-cyan-electric mb-3">Formato de Salida</label>
                        <select id="formatSelect" class="w-full bg-black/40 border border-white/5 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-cyan-electric transition-colors appearance-none">
                            <option value="webp" selected>WebP</option>
                            <option value="jpeg">JPG</option>
                            <option value="png">PNG</option>
                        </select>
                    </div>
                    <div>
                        <div class="flex justify-between items-center mb-3">
                            <label id="qualityLabel" class="text-[10px] font-bold uppercase tracking-widest text-cyan-electric">Calidad</label>
                            <span id="qualityVal" class="text-sm font-bold text-white">80%</span>
                        </div>
                        <input type="range" id="qualityRange" min="10" max="100" value="80"
                            class="w-full h-1.5 rounded-lg appearance-none cursor-pointer accent-cyan-electric">
                    </div>
                </div>
            </div>

            <!-- Result Area (Hidden) -->
            <div id="resultArea" class="hidden w-full mb-12 animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="glass rounded-2xl p-6 text-left">
                        <p id="originLabel" class="text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-4">Original</p>
                        <div class="aspect-video flex items-center justify-center bg-black/50 rounded-xl overflow-hidden mb-4 border border-white/5">
                            <img id="prevOriginal" class="max-h-full max-w-full object-contain">
                        </div>
                        <p id="originSize" class="text-right text-sm font-mono text-gray-400">0 KB</p>
                    </div>
                    <div class="glass rounded-2xl p-6 border-cyan-electric/20 text-left relative">
                        <div class="flex justify-between items-center mb-4">
                            <p id="targetLabel" class="text-[10px] font-bold uppercase tracking-widest text-cyan-electric">Resultado</p>
                            <span id="savingBadge" class="bg-cyan-electric text-black px-3 py-1 rounded-full text-[10px] font-black tracking-tighter opacity-0 transition-opacity">SAVED 0%</span>
                        </div>
                        <div class="aspect-video flex items-center justify-center bg-black/50 rounded-xl overflow-hidden mb-4 border border-white/5">
                            <img id="prevTarget" class="max-h-full max-w-full object-contain">
                        </div>
                        <p id="targetSize" class="text-right text-sm font-bold text-white">0 KB</p>
                    </div>
                </div>

                <button id="downloadBtn"
                    class="w-full sm:w-auto bg-cyan-electric hover:bg-cyan-400 text-black font-black py-4 px-12 rounded-2xl transition-all hover:scale-[1.02] active:scale-95 shadow-xl shadow-cyan-electric/20 text-lg">
                    Descargar Archivo
                </button>
            </div>

            <!-- Privacy Badge -->
            <div class="inline-flex items-center gap-2 text-[10px] text-gray-500 glass px-5 py-2 rounded-full uppercase tracking-[0.2em] font-bold opacity-70">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-cyan-electric" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
                <span id="privacyDisclaimer">Privacidad Total: Procesamiento 100% Local</span>
            </div>
        </section>

        <!-- Bottom Ad Slot -->
        <div class="ad-slot w-full max-w-2xl mt-12" id="ad-bottom" data-label="Advertisement / Anuncio"></div>
    </main>

    <!-- Footer -->
    <footer class="p-12 border-t border-white/5 text-center relative z-20">
        <div class="flex flex-wrap justify-center gap-8 mb-8 text-[10px] font-bold uppercase tracking-widest">
            <button onclick="openModal('privacyModal')" id="privacyLink" class="text-gray-500 hover:text-cyan-electric transition-colors">Privacy</button>
            <button onclick="openModal('termsModal')" id="termsLink" class="text-gray-500 hover:text-cyan-electric transition-colors">Terms</button>
            <button onclick="openModal('supportModal')" id="supportLink" class="text-cyan-electric hover:text-white transition-colors">Support Project</button>
            <button onclick="openModal('contactModal')" id="contactLink" class="text-gray-500 hover:text-cyan-electric transition-colors">Contact</button>
        </div>
        <p class="text-gray-700 text-[10px] tracking-[0.3em] font-medium uppercase">&copy; 2026 MEDIA-FASTCONVERT &bull; BY <a href="https://optimicrotools.com" class="text-white hover:text-cyan-electric">OPTIMICROTOOLS</a> &bull; LUXURY HUB-MATCH</p>
    </footer>

    <!-- Modals -->
    <div id="privacyModal" class="modal">
        <div class="glass max-w-2xl w-[90%] max-h-[85vh] overflow-y-auto p-12 rounded-[32px] relative animate-fade-in shadow-2xl">
            <button onclick="closeModal('privacyModal')" class="absolute top-8 right-8 text-gray-500 hover:text-white transition-colors text-2xl">&times;</button>
            <h2 id="modalPrivacyTitle" class="text-3xl font-black mb-8 text-cyan-electric tracking-tight uppercase">Política de Privacidad</h2>
            <div id="modalPrivacyContent" class="text-gray-400 space-y-6 text-sm leading-relaxed text-left"></div>
        </div>
    </div>

    <div id="termsModal" class="modal">
        <div class="glass max-w-2xl w-[90%] max-h-[85vh] overflow-y-auto p-12 rounded-[32px] relative animate-fade-in shadow-2xl">
            <button onclick="closeModal('termsModal')" class="absolute top-8 right-8 text-gray-500 hover:text-white transition-colors text-2xl">&times;</button>
            <h2 id="modalTermsTitle" class="text-3xl font-black mb-8 text-cyan-electric tracking-tight uppercase">Términos de Servicio</h2>
            <div id="modalTermsContent" class="text-gray-400 space-y-6 text-sm leading-relaxed text-left"></div>
        </div>
    </div>

    <div id="supportModal" class="modal">
        <div class="glass max-w-md w-[90%] p-10 rounded-[32px] relative animate-fade-in shadow-2xl text-center">
            <button onclick="closeModal('supportModal')" class="absolute top-8 right-8 text-gray-500 hover:text-white transition-colors text-2xl">&times;</button>
            <h2 id="supportTitle" class="text-3xl font-black mb-6 text-cyan-electric tracking-tight uppercase">Support Project</h2>
            <p id="supportSub" class="text-gray-400 text-sm mb-8 leading-relaxed font-light">Mantenemos el ecosistema libre de trackers y servidores. Ayúdanos a seguir adelante.</p>
            <div class="space-y-4">
                <a href="https://www.buymeacoffee.com/jota302" target="_blank" class="flex items-center justify-between w-full glass p-5 rounded-2xl hover:border-cyan-electric transition-all group">
                    <span class="font-bold text-xs uppercase tracking-widest">Buy Me a Coffee</span>
                    <span class="text-cyan-electric group-hover:translate-x-1 transition-transform">→</span>
                </a>
                <a href="https://paypal.me/jota302" target="_blank" class="flex items-center justify-between w-full glass p-5 rounded-2xl hover:border-cyan-electric transition-all group">
                    <span class="font-bold text-xs uppercase tracking-widest">PayPal</span>
                    <span class="text-cyan-electric group-hover:translate-x-1 transition-transform">→</span>
                </a>
                <div class="glass p-6 rounded-2xl text-left border-cyan-electric/10 relative overflow-hidden shadow-inner">
                    <div class="absolute inset-0 bg-cyan-electric opacity-5"></div>
                    <p class="text-[9px] font-black uppercase tracking-[0.2em] text-gray-500 mb-3 relative z-10">Crypto (USDT TRC20)</p>
                    <div class="flex items-center gap-3 relative z-10">
                        <code class="text-[9px] text-cyan-electric font-mono truncate flex-grow">TE95Gtd8qTWnsEcqXxDEoQoKLNg2hMvVtV</code>
                        <button onclick="copyCrypto()" id="copyBtn" class="bg-cyan-electric text-black px-4 py-1.5 rounded-lg text-[10px] font-black hover:scale-105 active:scale-95 transition-all shadow-md">COPY</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="contactModal" class="modal">
        <div class="glass max-w-sm w-[90%] p-10 rounded-[32px] relative animate-fade-in shadow-2xl text-center">
            <button onclick="closeModal('contactModal')" class="absolute top-8 right-8 text-gray-500 hover:text-white transition-colors text-2xl">&times;</button>
            <h2 id="contactTitle" class="text-3xl font-black mb-8 text-cyan-electric tracking-tight uppercase">Contact</h2>
            <div class="grid grid-cols-2 gap-4">
                <a href="https://x.com/optimicrotools" target="_blank" class="glass p-6 rounded-2xl hover:border-cyan-electric transition-all flex flex-col items-center gap-3 group">
                    <svg class="w-6 h-6 text-white group-hover:text-cyan-electric transition-colors" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    <span class="text-[9px] font-bold uppercase tracking-widest mt-2">Twitter</span>
                </a>
                <a href="mailto:jota302@gmail.com" class="glass p-6 rounded-2xl hover:border-cyan-electric transition-all flex flex-col items-center gap-3 group">
                    <svg class="w-6 h-6 text-white group-hover:text-cyan-electric transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                    <span class="text-[9px] font-bold uppercase tracking-widest mt-2">Email</span>
                </a>
            </div>
        </div>
    </div>

    <script>
        const translations = {
            es: {
                mainTitle: "Media Optimization",
                mainSubtitle: "Conversión local ultra-rápida. Sin servidores, máxima privacidad y rendimiento de lujo.",
                dropText: "Suelta tu imagen aquí",
                dropHint: "PNG, JPG, WebP hasta 20MB",
                formatLabel: "Formato de Salida",
                qualityLabel: "Calidad",
                originLabel: "Original",
                targetLabel: "Resultado",
                downloadBtn: "Descargar Archivo",
                privacyDisclaimer: "Privacidad Total: Procesamiento 100% Local",
                privacyLink: "Privacidad",
                termsLink: "Términos",
                supportLink: "Apoyar Proyecto",
                contactLink: "Contacto",
                modalPrivacyTitle: "Política de Privacidad",
                modalTermsTitle: "Términos de Servicio",
                supportTitle: "Soporte Proyecto",
                supportSub: "Mantenemos el ecosistema libre de trackers y servidores. Ayúdanos a seguir adelante.",
                contactTitle: "Contacto Oficial",
                errorSize: "Archivo demasiado grande. Máximo 20MB.",
                errorFormat: "Formato de imagen no compatible para procesamiento local.",
                saved: "AHORRO",
                copy: "COPIAR",
                copied: "COPIADO"
            },
            en: {
                mainTitle: "Media Optimization",
                mainSubtitle: "Ultra-fast local conversion. No servers, maximum privacy and luxury performance.",
                dropText: "Drop your image here",
                dropHint: "PNG, JPG, WebP up to 20MB",
                formatLabel: "Output Format",
                qualityLabel: "Quality",
                originLabel: "Original",
                targetLabel: "Result",
                downloadBtn: "Download File",
                privacyDisclaimer: "Total Privacy: 100% Local Processing",
                privacyLink: "Privacy",
                termsLink: "Terms",
                supportLink: "Support Project",
                contactLink: "Contact",
                modalPrivacyTitle: "Privacy Policy",
                modalTermsTitle: "Terms of Service",
                supportTitle: "Support Project",
                supportSub: "We keep the ecosystem free of trackers and servers. Help us keep it going.",
                contactTitle: "Official Contact",
                errorSize: "File too large. Maximum 20MB.",
                errorFormat: "Invalid image format for local processing.",
                saved: "SAVED",
                copy: "COPY",
                copied: "COPIED"
            }
        };

        const legalText = {
            es: {
                privacy: "<p>En <strong>OptiMicroTools</strong>, la privacidad es absoluta. Media-FastConvert ha sido diseñado para operar íntegramente en su navegador (Client-Side).</p><div><strong>PROCESAMIENTO LOCAL:</strong> Sus imágenes nunca se suben a ningún servidor. El procesamiento se ejecuta en el hardware de su dispositivo.</div><div><strong>DATOS PERSONALES:</strong> No recopilamos, almacenamos ni compartimos información sobre sus archivos.</div><div><strong>FINANCIACIÓN:</strong> Utilizamos Google AdSense para financiar el desarrollo. AdSense puede recopilar datos de navegación anónimos.</div>",
                terms: "<p>Al utilizar esta herramienta, acepta los siguientes términos:</p><div><strong>USO:</strong> El servicio es gratuito para uso personal y comercial ilimitado.</div><div><strong>REPONSABILIDAD:</strong> El servicio se entrega 'tal cual'. No nos hacemos responsables por fallos técnicos o inconsistencias en los archivos generados.</div><div><strong>PROPIEDAD:</strong> Todos los derechos de imágenes resultantes pertenecen íntegramente al usuario original.</div>"
            },
            en: {
                privacy: "<p>At <strong>OptiMicroTools</strong>, your privacy is absolute. Media-FastConvert is designed to operate entirely in your browser (Client-Side).</p><div><strong>LOCAL PROCESSING:</strong> Your images are never uploaded to any server. Processing is executed on your device's hardware.</div><div><strong>PERSONAL DATA:</strong> We do not collect, store, or share information about your files.</div><div><strong>FUNDING:</strong> We use Google AdSense to fund development. AdSense may collect anonymous browsing data.</div>",
                terms: "<p>By using this tool, you agree to the following terms:</p><div><strong>USE:</strong> The service is free for unlimited personal and commercial use.</div><div><strong>LIABILITY:</strong> The service is provided 'as is'. We are not responsible for technical failures or inconsistencies in the generated files.</div><div><strong>OWNERSHIP:</strong> All rights to the resulting images belong entirely to the original user.</div>"
            }
        };

        let currentLang = localStorage.getItem('omf_lang') || (navigator.language.startsWith('es') ? 'es' : 'en');
        let originalFile = null;
        let originalImage = null;
        let currentDataUrl = null;

        function updateUI() {
            try {
                const t = translations[currentLang];
                document.documentElement.lang = currentLang;
                localStorage.setItem('omf_lang', currentLang);

                // Main UI
                document.getElementById('mainTitle').textContent = t.mainTitle;
                document.getElementById('mainSubtitle').textContent = t.mainSubtitle;
                document.getElementById('dropText').textContent = t.dropText;
                document.getElementById('dropHint').textContent = t.dropHint;
                document.getElementById('formatLabel').textContent = t.formatLabel;
                document.getElementById('qualityLabel').textContent = t.qualityLabel;
                document.getElementById('originLabel').textContent = t.originLabel;
                document.getElementById('targetLabel').textContent = t.targetLabel;
                document.getElementById('downloadBtn').textContent = t.downloadBtn;
                document.getElementById('privacyDisclaimer').textContent = t.privacyDisclaimer;

                // Footer & Modals
                document.getElementById('privacyLink').textContent = t.privacyLink;
                document.getElementById('termsLink').textContent = t.termsLink;
                document.getElementById('supportLink').textContent = t.supportLink;
                document.getElementById('contactLink').textContent = t.contactLink;
                
                document.getElementById('modalPrivacyTitle').textContent = t.modalPrivacyTitle;
                document.getElementById('modalTermsTitle').textContent = t.modalTermsTitle;
                document.getElementById('supportTitle').textContent = t.supportTitle;
                document.getElementById('supportSub').textContent = t.supportSub;
                document.getElementById('contactTitle').textContent = t.contactTitle;

                document.getElementById('modalPrivacyContent').innerHTML = legalText[currentLang].privacy;
                document.getElementById('modalTermsContent').innerHTML = legalText[currentLang].terms;
                document.getElementById('copyBtn').textContent = t.copy;
            } catch (err) {
                console.error("UI Update Error:", err);
            }
        }

        document.getElementById('langToggle').addEventListener('click', () => {
            currentLang = currentLang === 'es' ? 'en' : 'es';
            updateUI();
            if (originalFile) convertImage(); 
        });

        // Initialize
        updateUI();

        // Modal Controls
        window.openModal = (id) => document.getElementById(id).classList.add('active');
        window.closeModal = (id) => document.getElementById(id).classList.remove('active');
        window.onclick = (e) => { if (e.target.classList.contains('modal')) e.target.classList.remove('active'); };

        // Crypto Logic
        window.copyCrypto = () => {
            const addr = "TE95Gtd8qTWnsEcqXxDEoQoKLNg2hMvVtV";
            navigator.clipboard.writeText(addr).then(() => {
                const btn = document.getElementById('copyBtn');
                const t = translations[currentLang];
                btn.textContent = t.copied;
                btn.classList.replace('bg-cyan-electric', 'bg-green-500');
                setTimeout(() => {
                    btn.textContent = t.copy;
                    btn.classList.replace('bg-green-500', 'bg-cyan-electric');
                }, 2000);
            });
        };

        // Core Image Processing
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const controls = document.getElementById('controls');
        const resultArea = document.getElementById('resultArea');
        const qualityRange = document.getElementById('qualityRange');
        const qualityVal = document.getElementById('qualityVal');
        const formatSelect = document.getElementById('formatSelect');
        const downloadBtn = document.getElementById('downloadBtn');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(ev => dropZone.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); }));
        ['dragenter', 'dragover'].forEach(ev => dropZone.addEventListener(ev, () => dropZone.classList.add('drag-active')));
        ['dragleave', 'drop'].forEach(ev => dropZone.addEventListener(ev, () => dropZone.classList.remove('drag-active')));

        dropZone.addEventListener('drop', e => handleFiles(e.dataTransfer.files));
        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = e => handleFiles(e.target.files);

        function handleFiles(files) {
            if (!files.length) return;
            const file = files[0];
            const t = translations[currentLang];

            if (!file.type.startsWith('image/')) {
                alert(t.errorFormat);
                return;
            }
            if (file.size > 20 * 1024 * 1024) {
                alert(t.errorSize);
                return;
            }

            try {
                originalFile = file;
                const reader = new FileReader();
                reader.onload = e => {
                    const img = new Image();
                    img.onload = () => {
                        originalImage = img;
                        document.getElementById('prevOriginal').src = e.target.result;
                        document.getElementById('originSize').textContent = formatBytes(file.size);
                        controls.classList.remove('hidden');
                        resultArea.classList.remove('hidden');
                        convertImage();
                        window.scrollTo({ top: controls.offsetTop - 50, behavior: 'smooth' });
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } catch (err) {
                console.error("File Read Error:", err);
                alert("Error reading file.");
            }
        }

        async function convertImage() {
            if (!originalImage) return;

            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = originalImage.width;
                canvas.height = originalImage.height;
                ctx.drawImage(originalImage, 0, 0);

                const format = formatSelect.value;
                const quality = qualityRange.value / 100;
                const mime = `image/${format === 'jpeg' ? 'jpeg' : format}`;
                
                currentDataUrl = canvas.toDataURL(mime, quality);
                
                const prevTarget = document.getElementById('prevTarget');
                prevTarget.src = currentDataUrl;

                const size = Math.round((currentDataUrl.length - `data:${mime};base64,`.length) * 3 / 4);
                document.getElementById('targetSize').textContent = formatBytes(size);

                const saving = Math.round(((originalFile.size - size) / originalFile.size) * 100);
                const badge = document.getElementById('savingBadge');
                if (saving > 0) {
                    badge.textContent = `${translations[currentLang].saved} ${saving}%`;
                    badge.classList.remove('opacity-0');
                    badge.classList.add('opacity-100');
                } else {
                    badge.classList.add('opacity-0');
                    badge.classList.remove('opacity-100');
                }
            } catch (err) {
                console.error("Conversion Error:", err);
            }
        }

        downloadBtn.onclick = () => {
            if (!currentDataUrl) return;
            try {
                const format = formatSelect.value;
                const name = originalFile.name.split('.').slice(0, -1).join('.');
                const link = document.createElement('a');
                link.download = `${name}-opti.${format}`;
                link.href = currentDataUrl;
                link.click();
            } catch (err) {
                console.error("Download Error:", err);
            }
        };

        qualityRange.oninput = (e) => {
            qualityVal.textContent = `${e.target.value}%`;
            convertImage();
        };

        formatSelect.onchange = convertImage;

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>

</html>
